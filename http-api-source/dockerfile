# Stage 1: Build frontend
FROM node:20-slim AS frontend-builder
WORKDIR /frontend
COPY frontend-src/package*.json ./
RUN npm install
COPY frontend-src/ ./
RUN npm run build

# Stage 2: Python API with frontend
FROM python:3.12.5-slim-bookworm
ENV DEBIAN_FRONTEND=noninteractive \
    PYTHONUNBUFFERED=1 \
    PYTHONIOENCODING=UTF-8 \
    PYTHONPATH="/app"
WORKDIR /app
COPY requirements.txt *.whl ./
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
COPY --from=frontend-builder /frontend/dist ./frontend
ENTRYPOINT ["python3", "main.py"]
