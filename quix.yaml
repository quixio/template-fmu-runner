# Quix Project Descriptor
# This file describes the data pipeline and configuration of resources of a Quix Project.

metadata:
  version: 1.0

# This section describes the Deployments of the data pipeline
deployments:
  - name: Simulation API & UI
    application: http-api-source
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    publicAccess:
      enabled: true
      urlPrefix: simulation-api
    state:
      enabled: true
      size: 1
    network:
      serviceName: simulation-api
      ports:
        - port: 80
          targetPort: 80
    variables:
      - name: output
        inputType: OutputTopic
        description: The Kafka topic to publish simulation requests to.
        required: true
        value: simulation
      - name: HTTP_AUTH_TOKEN
        inputType: Secret
        description: A security token for authorizing simulation submissions.
        required: true
        secretKey: http_auth_token
      - name: QUIXLAKE_API_URL
        inputType: FreeText
        description: QuixLake API URL for data lake queries
        required: true
        value: https://quixlake-quixers-quixlakev2timeseries-prod.az-france-0.app.quix.io
      - name: S3_ENDPOINT
        inputType: FreeText
        description: S3/MinIO endpoint URL for storing FMU models.
        value: http://minio:80
      - name: S3_ACCESS_KEY
        inputType: Secret
        description: S3 access key ID.
        secretKey: s3_user
      - name: S3_SECRET_KEY
        inputType: Secret
        description: S3 secret access key.
        secretKey: s3_password
      - name: S3_BUCKET
        inputType: FreeText
        description: S3 bucket name for FMU models.
        value: fmu-models
    plugin:
      embeddedView:
        enabled: true
        hideHeader: true
        default: true
      sidebarItem:
        show: true
        label: FMU Runner
        icon: drag_indicator
        order: 1
  - name: FMU Runner
    application: fmu-runner
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    state:
      enabled: true
      size: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the input topic to listen to (simulation requests from HTTP API).
        value: simulation
      - name: output
        inputType: OutputTopic
        description: Name of the output topic to write simulation results to.
        value: simulation-results
      - name: S3_ENDPOINT
        inputType: FreeText
        description: S3/MinIO endpoint URL for fetching FMU model binaries.
        value: http://minio:80
      - name: S3_ACCESS_KEY
        inputType: Secret
        description: S3 access key ID.
        secretKey: s3_user
      - name: S3_SECRET_KEY
        inputType: Secret
        description: S3 secret access key.
        secretKey: s3_password
      - name: S3_BUCKET
        inputType: FreeText
        description: S3 bucket name for FMU models.
        value: fmu-models
  - name: Test Generator
    application: test-generator
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Topic for failed validations.
        value: validation-failure
      - name: output
        inputType: OutputTopic
        description: Topic to publish new test configurations.
        value: simulation
      - name: NUM_TESTS
        inputType: FreeText
        description: Number of test variations to generate per failure.
        value: 10
  - name: Quix DataLake Timeseries Sink
    application: quix-datalake-timeseries-sink
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 2000
      replicas: 1
    variables:
      - name: S3_BUCKET
        inputType: FreeText
        value: datalake
      - name: AWS_ENDPOINT_URL
        inputType: FreeText
        value: http://minio:80
      - name: CATALOG_URL
        inputType: FreeText
        value: ''
  - name: Run Validation
    application: validator
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        description: Name of the input topic to listen to (simulation results).
        value: simulation-results
      - name: output_success
        inputType: OutputTopic
        description: Name of the output topic for successful validations.
        value: validation-success
      - name: output_failure
        inputType: OutputTopic
        description: Name of the output topic for failed validations.
        value: validation-failure
  - name: MinIO
    application: minio
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 800
      replicas: 1
    network:
      serviceName: minio
      ports:
        - port: 80
          targetPort: 9000
    variables:
      - name: MINIO_ROOT_USER
        inputType: Secret
        description: The root username to initialize Minio with
        required: true
        secretKey: s3_user
      - name: MINIO_ROOT_PASSWORD
        inputType: Secret
        description: The root password to initialize Minio with
        required: true
        secretKey: s3_password

# This section describes the Topics of the data pipeline
topics:
  - name: simulation
    dataTier: Bronze
  - name: simulation-results
    dataTier: Silver
  - name: validation-success
    dataTier: Gold
  - name: validation-failure
    dataTier: Silver
  - name: generated-opc_ua_data
    dataTier: Bronze
  - name: http_data
    dataTier: Bronze
  - name: normalized_data
    dataTier: Silver
